# Introduction {#intro}

The [`bookdown`](https://bookdown.org/yihui/bookdown/) package can be installed from CRAN or Github:

```{r eval=FALSE}
install.packages("bookdown")
# or the development version
# devtools::install_github("rstudio/bookdown")
```

[`bookdown`](https://bookdown.org/yihui/bookdown/) is a tool for combining multiple R Markdown documents into a single book.

Each `.Rmd` file contains one and only one chapter, and a chapter is defined by the first-level heading `#` (e.g. `# Introduction`). 
To learn more about R Markdown read [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/).  

To compile to PDF, you need to have LaTeX installed on your machine. `xelatex` and `lualatex` are recommended as they support Unicode better 
(see [here](https://tex.stackexchange.com/questions/3393/what-is-xetex-exactly-and-why-should-i-use-it) and [here](https://tex.stackexchange.com/questions/36/differences-between-luatex-context-and-xetex) for details).
For a lightweight LaTeX installation one can use [`TinyTeX`](https://yihui.org/tinytex/) (which includes `xelatex`).

You can label chapter and section titles using the `{#label}` syntax. For example `# Introduction {#intro}` assigns the label `intro` to the introductory chapter. 
We can then reference the chapter using the `\@ref(label)` syntax. For example, Chapter `\@ref(intro)` renders as Chapter \@ref(intro). 

## Figures and Tables

Figures and tables with captions are placed in `figure` and `table` environments, respectively.

Reference a figure by its code chunk label with the `fig:` prefix. For example, Figure `\@ref(fig:nice-fig)` renders as Figure \@ref(fig:nice-fig).

```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19)
```

Similarly, tables generated by `knitr::kable()` can be referenced by their code chunk label with the `tab:` prefix. For example, Table `\@ref(tab:nice-tab)` renders as Table \@ref(tab:nice-tab).

```{r nice-tab, tidy=FALSE}
knitr::kable(
  head(iris, 10), caption = 'Here is a nice table!',
  booktabs = TRUE
)
```

You can also do a text reference for a figure caption which is useful if you want to include a mathematical expression and/or caption is very long. The syntax is "`(ref:label)` Some text which can include equations". 

(ref:fig2) A text reference with a mathematical expression $y_i=\beta_0 + \beta_1x_i + \epsilon_i$ and $\epsilon_i \sim \mathcal{N}(0, \sigma^2)$. 

```{r nice-fig2, fig.cap='(ref:fig2)', out.width='80%', fig.asp=.75, fig.align='center'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19, col=2)
```

You can write citations, too. For example, we are using the **bookdown** package [@R-bookdown] in this sample book, which was built on top of R Markdown and **knitr** [@xie2015].

## Equations

````
\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation} 
````

renders as:

\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation} 

You may refer to it using `\@ref(eq:binom)` which renders as \@ref(eq:binom).

Please make sure equations \index{equations} without labels are not numbered by either using the `equation*` environment or adding `\nonumber` or `\notag` to your equations. The same rules apply to other math environments. For aligning multiple equations, `align` is the preferred environment. For example:\index{align}    

````
\begin{align} 
g(X_{n}) & = g(\theta)+g'({\tilde{\theta}})(X_{n}-\theta) \notag \\
\sqrt{n}[g(X_{n})-g(\theta)] & = g'\left({\tilde{\theta}}\right) 
\sqrt{n}[X_{n}-\theta](\#eq:align) \\
\end{align} 
````

renders as

\begin{align} 
g(X_{n}) & = g(\theta)+g'({\tilde{\theta}})(X_{n}-\theta) \notag \\
\sqrt{n}[g(X_{n})-g(\theta)] & = g'\left({\tilde{\theta}}\right) 
\sqrt{n}[X_{n}-\theta](\#eq:align) \\
\end{align} 

Use split to have multiple lines with one equation reference. For example:

````
\begin{equation} 
\begin{split}
\mathrm{Var}(\hat{\beta}) & =\mathrm{Var}((X'X)^{-1}X'y)\\
 & =(X'X)^{-1}X'\mathrm{Var}(y)((X'X)^{-1}X')'\\
 & =(X'X)^{-1}X'\mathrm{Var}(y)X(X'X)^{-1}\\
 & =(X'X)^{-1}X'\sigma^{2}IX(X'X)^{-1}\\
 & =(X'X)^{-1}\sigma^{2}
\end{split}
(\#eq:var-beta)
\end{equation} 
````
renders as

\begin{equation} 
\begin{split}
\mathrm{Var}(\hat{\beta}) & =\mathrm{Var}((X'X)^{-1}X'y)\\
 & =(X'X)^{-1}X'\mathrm{Var}(y)((X'X)^{-1}X')'\\
 & =(X'X)^{-1}X'\mathrm{Var}(y)X(X'X)^{-1}\\
 & =(X'X)^{-1}X'\sigma^{2}IX(X'X)^{-1}\\
 & =(X'X)^{-1}\sigma^{2}
\end{split}
(\#eq:var-beta)
\end{equation} 

## Examples

Using the `example` environment. For example: \index{confidence intervals}

````
``{example, eg1, name='Confidence intervals using the Normal approximation.'}
\begin{alignat*}{2}
-z_{\alpha/2} \leq{} & \;\;\;Z & \leq{} & z_{\alpha/2} \\
-z_{\alpha/2} \leq{} & \frac{\hat{\mu}-\mu}{\frac{\sigma}{\sqrt{n}}} & \leq{} & z_{\alpha/2}\\
\hat{\mu} - z_{\alpha/2}\frac{\sigma}{\sqrt{n}} \leq{} & \;\;\;\mu & \leq{} & \hat{\mu} + z_{\alpha/2}\frac{\sigma}{\sqrt{n}}
\end{alignat*}
``
````
renders as

```{example, eg1, name='Confidence intervals using the Normal approximation.'}
\begin{alignat*}{2}
-z_{\alpha/2} \leq{} & \;\;\;Z & \leq{} & z_{\alpha/2} \\
-z_{\alpha/2} \leq{} & \frac{\hat{\mu}-\mu}{\frac{\sigma}{\sqrt{n}}} & \leq{} & z_{\alpha/2}\\
\hat{\mu} - z_{\alpha/2}\frac{\sigma}{\sqrt{n}} \leq{} & \;\;\;\mu & \leq{} & \hat{\mu} + z_{\alpha/2}\frac{\sigma}{\sqrt{n}}
\end{alignat*}
```

We can reference the example by its code chunk label with the `exm:` prefix. For example, Example `\@ref(exm:eg1)` renders as Example \@ref(exm:eg1). 

There are also `theorem`, `lemma`, etc. environments. Full details can be found [here](https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html).

You can also create blocks of text using the simple `>` without the need for a chunk.  For example, 

````
> **Aside**: using the model to predict outside of the range of the observed data is called **extrapolating**.
````

renders as

> **Aside**: using the model to predict outside of the range of the observed data is called **extrapolating**.

## Shiny apps and HTML widgets

You can add [Shiny apps](https://bookdown.org/yihui/bookdown/web-pages-and-shiny-apps.html) and [HTML widgets](https://bookdown.org/yihui/bookdown/html-widgets.html) to your book.

For example, using the `knitr::include_app(...)` function we can embed a Shiny app that is hosted somewhere else. 
Note that this app renders well in the web version of the notes but the screenshot needs resizing in the PDF version.

(ref:myshiny) An example of a shiny app. You can see a live version [here](https://lindesaysh.shinyapps.io/faithfulshiny/)

```{r myshiny, echo=FALSE, fig.cap='(ref:myshiny)', screenshot.opts = list(delay = 2), out.width='100%'}
knitr::include_app("https://lindesaysh.shinyapps.io/faithfulshiny/")
```